module.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=8)}([function(e,t){e.exports=require("vscode")},function(e,t){e.exports=require("require('upath')")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return s}));const i=n(1);class s{static build(t){return i.join(e,"..","..","..","media",t)}}}).call(this,"/index.js")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("url")},function(e,t){e.exports=require("require('glob')")},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";n.r(t);var i,s,r,o=n(0);!function(e){e.TEST="test",e.DESCRIBE="describe"}(i||(i={})),function(e){e.RUN_TEST="yajer.run.test",e.OPEN_TEST="yajer.open.test",e.DEBUG_FILE="yajer.debug.file",e.CONFIG_FILE="yajer.config.file"}(s||(s={})),function(e){e.RUN_TEST="yajer.run.test.context",e.RUN_FILE="yajer.run.file.context",e.OPEN_TEST="yajer.open.test.context",e.DEBUG_FILE="yajer.debug.file.context",e.CONFIG_FILE="yajer.config.reset.context"}(r||(r={}));var c=n(3),a=n(4),u=n(5);const d=n(1);class l{static getWorkspaceFolderPath(){const[e]=o.workspace.workspaceFolders;return e?e.uri.fsPath:"./"}static getConfigsPackageJSON(){const e=/jest.+--config=([a-z0-9\/.]+)/i,t=d.join(l.getWorkspaceFolderPath(),"package.json"),n=Object(c.readFileSync)(new a.URL(`file://${t}`),"utf8").split("\n").reduce((t,n)=>{const i=e.exec(n);return i&&t.push(i[1]),t},[]);return[...new Set(n)]}static getConfigs(e=!1){const t=o.workspace.getConfiguration().get("yajer.jestConfig");if(t)return[t];const n=`+(${["jest.config.js","jest.config.json",...o.workspace.getConfiguration().get("yajer.jestConfigPatterns").split(",")].filter(Boolean).map(e=>`*${e.trim()}`).join("|")})`,i={matchBase:!0,nodir:!0,ignore:"node_modules/**",cwd:l.getWorkspaceFolderPath()};return(0===l.configs.length||e)&&(l.configs=u.sync(n,i)),l.configs}static getExecutable(){const e=process.platform.includes("win32")?l.WIN_PATH:l.UNIX_PATH;return d.join(l.getWorkspaceFolderPath(),e)}static getCommand(){return o.workspace.getConfiguration().get("yajer.jestCommand")||`node ${l.getExecutable()}`}}l.configs=[],l.WIN_PATH="./node_modules/jest/bin/jest.js",l.UNIX_PATH="./node_modules/.bin/jest";var h=n(2);class g extends o.TreeItem{constructor(e){super(e.name,o.TreeItemCollapsibleState.None),this.item=e,this.command={command:s.OPEN_TEST,title:"",arguments:[{context:this}]}}get id(){return String(this.item.id)}get tooltip(){return`${this.isTest?"test":"describe"}('${this.item.name}')`}get contextValue(){return"test"}get iconPath(){const e=this.isTest?"test.svg":"describe.svg";return{dark:h.a.build(e),light:h.a.build(e)}}get isTest(){return this.item.type===i.TEST}get parentID(){return String(this.item.parent)}set children(e){this.items=e,this.items.length&&(this.collapsibleState=o.TreeItemCollapsibleState.Expanded)}get children(){return this.items}}const f=e=>{let t=-1;const n={},i=[...e];return i.forEach(i=>{const s=i.range.start.character,r=n[s];s<t&&((e,t)=>{for(let n in e)Number(n)>t&&delete e[n]})(n,s),i.parent=r?e[r].parent:(e=>Object.values(e).slice(-1)[0])(n),n[s]=i.id,t=s}),i},m=new g({id:void 0,name:"",range:null,type:i.DESCRIBE}),p=(e,t=m,n=[])=>{const i=e.filter(e=>e.parentID===t.id);return i.length>0&&("undefined"===t.id?n=i:t.children=i,i.forEach(t=>p(e,t,n))),n};class w{constructor(e){this.document=e}getLines(){const e=[];if(this.document)for(let t=0;t<this.document.lineCount;t++)e.push(this.document.lineAt(t));return e}getTests(){const e=/(it|test|describe)(\.(skip|only))?\(['"]([^'"]+)['"],/i,t=this.getLines().reduce((t,n)=>{const{firstNonWhitespaceCharacterIndex:s,range:r,text:c}=n,a=e.exec(c);return a&&t.push({id:t.length,name:a[4],range:new o.Range(new o.Position(r.start.line,s),r.end),type:a[1]===i.DESCRIBE?i.DESCRIBE:i.TEST}),t},[]);return f(t)}getTestOnLine(e){return this.findTestOnLine(this.getTests(),e)}findTestOnLine(e,t){return e.filter(({range:{start:e}})=>e.line===t).pop()}}class T{constructor(e){this.extension=e}getDecorations(){return this.extension.document.getTests().map(({range:e})=>({range:e}))}setDecorations(){this.extension.editor&&this.extension.editor.setDecorations(T.decorationType,this.getDecorations())}update(){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(this.setDecorations.bind(this),500)}}T.decorationType=o.window.createTextEditorDecorationType({after:{margin:"0 0 0 .5rem",contentText:"â–¶",color:"#c5c5c5"}});class x{constructor(e){this.extension=e}getCommandMarkdown(e,t,n){const i=new o.MarkdownString(this.extension.commands[e].getMarkdown(t,n));return i.isTrusted=!0,i}getRunTestMarkdown(e){return this.getCommandMarkdown(s.RUN_TEST,{title:"Run Test",description:"Run current test with last known config"},e)}getRunFileMarkdown(e){return this.getCommandMarkdown(s.RUN_TEST,{title:"Run File",description:"Run current file with last known config"},Object.assign(Object.assign({},e),{test:void 0}))}getDebugTestMarkdown(e){return this.getCommandMarkdown(s.DEBUG_FILE,{title:"Debug FIle",description:"Debug current file with last known config"},Object.assign({},e))}getConfigTestMarkdown(e){return this.getCommandMarkdown(s.CONFIG_FILE,{title:"Reset Config",description:"Reset configuration for current file"},e)}getMessage(e){const t=this.getRunTestMarkdown(e),n=this.getRunFileMarkdown(e),i=this.getDebugTestMarkdown(e),s=this.getConfigTestMarkdown(e),r=[t.value,n.value,i.value,"***",s.value].join("  \n"),c=new o.MarkdownString(r);return c.isTrusted=!0,c}}class b{constructor(e){this.extension=e,this.hoverMessage=new x(e)}dispose(){this.unregister()}provideHover(e,t,n){const i=this.extension.document.getTestOnLine(t.line),s=e.validateRange(new o.Range(t.line,Number.MAX_SAFE_INTEGER,t.line,Number.MAX_SAFE_INTEGER)),r=this.hoverMessage.getMessage({file:this.extension.editor.document.fileName,test:i.name});return new o.Hover(r,s)}register(){if(this.unregister(),void 0===this.extension.editor)return;const e=[o.languages.registerHoverProvider({pattern:this.extension.editor.document.uri.fsPath},{provideHover:this.provideHover.bind(this)})];this.hoverDisposable=o.Disposable.from(...e)}unregister(){this.hoverDisposable&&this.hoverDisposable.dispose()}}var v=function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{a(i.next(e))}catch(e){r(e)}}function c(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,c)}a((i=i.apply(e,t||[])).next())}))};class E{constructor(){this.TERMINAL_NAME="Yet Another Jest Runner",o.window.onDidCloseTerminal(()=>{this.terminal=null})}get(e){return v(this,void 0,void 0,(function*(){return!this.terminal&&(this.terminal=o.window.createTerminal(this.TERMINAL_NAME)),this.terminal.show(),e&&(yield this.clear()),this.terminal}))}clear(){return v(this,void 0,void 0,(function*(){yield o.commands.executeCommand("workbench.action.terminal.clear")}))}}class C{constructor(e){this.extension=e,this.items=[],this.subscriptions=[],this.onDidChangeTreeDataEventEmitter=new o.EventEmitter,this.onDidChangeTreeData=this.onDidChangeTreeDataEventEmitter.event,this.refresh(),this.subscribe()}refresh(){this.onDidChangeTreeDataEventEmitter.fire(),this.items=p(this.extension.document.getTests().map(e=>new g(e))),o.commands.executeCommand("setContext","hasTestsInView",!!this.items.length),this.subscribe()}getTreeItem(e){return e}getChildren(e){return e?e.children:this.items}register(){const e=o.window.createTreeView("yajer",{treeDataProvider:this,showCollapseAll:!0});this.extension.context.subscriptions.push(e)}subscribe(){this.unsubscribe(),this.subscribeOne(r.CONFIG_FILE,s.CONFIG_FILE,{}),this.subscribeOne(r.RUN_TEST,s.RUN_TEST,{}),this.subscribeOne(r.RUN_FILE,s.RUN_TEST,{context:null}),this.subscribeOne(r.OPEN_TEST,s.OPEN_TEST,{}),this.subscribeOne(r.DEBUG_FILE,s.DEBUG_FILE,{})}subscribeOne(e,t,n){const i=this.extension.editor,s=this.extension.commands,r=this.extension.context.subscriptions,c=Object.assign({file:i&&i.document.fileName},n),a=o.commands.registerCommand(e,(e=this)=>s[t].execute(Object.assign(Object.assign({},c),{context:e})));r.push(a),this.subscriptions.push(a)}unsubscribe(){this.subscriptions.forEach(e=>e.dispose())}}var y=n(6);class _{static show(){const e=l.getConfigs()||[];return e.length<=1?e.pop():o.window.showQuickPick(l.getConfigs())}}var j=function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{a(i.next(e))}catch(e){r(e)}}function c(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,c)}a((i=i.apply(e,t||[])).next())}))};class I{constructor(e){this.command=e,this.disposable=o.commands.registerCommand(e,e=>this.execute(e),this)}generateHash(e){return y.createHash("md5").update(e).digest("hex")}removeConfig(e){I.configs.delete(this.generateHash(e))}getConfig(e){return j(this,void 0,void 0,(function*(){const t=this.generateHash(e);return!I.configs.has(t)&&I.configs.set(t,yield _.show()),I.configs.get(t)}))}dispose(){this.disposable&&this.disposable.dispose()}getMarkdownArgs(e){return`command:${this.command}?${encodeURIComponent(JSON.stringify(e))}`}getMarkdown(e,t){return`[${e.title}](${this.getMarkdownArgs(t)} "${e.description}")`}}I.configs=new Map;var D=function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{a(i.next(e))}catch(e){r(e)}}function c(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,c)}a((i=i.apply(e,t||[])).next())}))};const N=n(1);class O extends I{constructor(e){super(s.RUN_TEST),this.extension=e}execute(e){return D(this,void 0,void 0,(function*(){const{file:t,context:n}=e,i=yield this.getConfig(t),s=n?n.item.name:e.test;let r=`${l.getCommand()} ${N.normalize(t)}`;s&&(r=`${r} -t "${s}"`),i&&(r=`${r} -c "${i}"`),(yield this.extension.terminal.get(!0)).sendText(r)}))}}var S=function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{a(i.next(e))}catch(e){r(e)}}function c(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,c)}a((i=i.apply(e,t||[])).next())}))};const k=n(1);class F extends I{constructor(e){super(s.DEBUG_FILE),this.extension=e}execute(e){return S(this,void 0,void 0,(function*(){const{file:t,test:n}=e,i=yield this.getConfig(t),s={type:"node",request:"launch",name:"Debug Jest Tests",program:l.getExecutable(),args:[k.normalize(t),"--config",i],console:"integratedTerminal",internalConsoleOptions:"neverOpen",disableOptimisticBPs:!0};o.debug.startDebugging(void 0,s)}))}}var P=function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{a(i.next(e))}catch(e){r(e)}}function c(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,c)}a((i=i.apply(e,t||[])).next())}))};class M extends I{constructor(e){super(s.OPEN_TEST),this.extension=e}execute(e){return P(this,void 0,void 0,(function*(){const{context:t}=e,{document:n}=this.extension.editor,i={preserveFocus:!0,selection:t.item.range};yield o.window.showTextDocument(n,i)}))}}var R=n(7);class L extends I{constructor(e){super(s.CONFIG_FILE),this.extension=e}execute(e){const{file:t}=e;this.removeConfig(t),o.window.showInformationMessage(`Configuration reset for ${R.basename(t)}`)}}function U(e){const t=o.window.activeTextEditor,n={context:e,document:new w(t&&t.document),editor:t,terminal:new E,commands:{}};n.commands[s.RUN_TEST]=new O(n),n.commands[s.OPEN_TEST]=new M(n),n.commands[s.DEBUG_FILE]=new F(n),n.commands[s.CONFIG_FILE]=new L(n);const i=new T(n),r=new b(n),c=new C(n);i.update(),r.register(),c.register(),l.getConfigs(),o.window.onDidChangeActiveTextEditor(e=>{n.editor=e,n.document=new w(e.document),i.update(),r.register(),c.refresh()},null,e.subscriptions),o.workspace.onDidChangeTextDocument(e=>{n.editor&&e.document===n.editor.document&&(i.update(),c.refresh())},null,e.subscriptions),o.workspace.onDidChangeConfiguration(e=>{e.affectsConfiguration("yajer.jestConfigPatterns")&&l.getConfigs(!0)})}function A(){}n.d(t,"activate",(function(){return U})),n.d(t,"deactivate",(function(){return A}))}]);
//# sourceMappingURL=extension.js.map